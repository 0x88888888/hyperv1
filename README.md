Was able to make this work on with simple cases, then I tried implementing EPT tables and everything broke.
TODO: Fix EPT tables.
